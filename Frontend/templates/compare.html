{% extends "base.html" %}
{% block content %}

<div class="container">

  <h2 class="fw-bold mb-4">Compare Recipes</h2>

  <!-- Input Form -->
  <div class="card bg-dark border-secondary shadow-sm mb-4">
    <div class="card-body">

      <h5 class="mb-3">Enter Two Recipe IDs & Your Ingredients</h5>

      <div class="row g-3">
        <div class="col-md-4">
          <input id="id1" class="form-control bg-dark text-light border-secondary" placeholder="Recipe ID 1">
        </div>

        <div class="col-md-4">
          <input id="id2" class="form-control bg-dark text-light border-secondary" placeholder="Recipe ID 2">
        </div>

        <div class="col-md-4">
          <input id="userIng" class="form-control bg-dark text-light border-secondary" placeholder="Your ingredients (comma separated)">
        </div>
      </div>

      <button class="btn btn-outline-light mt-3" onclick="compare()">Compare</button>

    </div>
  </div>


  <!-- Comparison Result -->
  <div id="compareBox" class="row g-4" style="display:none;">

    <!-- Recipe 1 -->
    <div class="col-md-6">
      <div class="card bg-dark border-secondary">
        <div class="card-body">

          <h4 id="name1"></h4>
          <p><strong>Match Score:</strong> <span id="score1"></span>%</p>

          <h6 class="mt-3">Ingredients Required:</h6>
          <ul id="ing1"></ul>

          <h6 class="mt-3">Missing Ingredients:</h6>
          <ul id="miss1"></ul>

        </div>
      </div>
    </div>

    <!-- Recipe 2 -->
    <div class="col-md-6">
      <div class="card bg-dark border-secondary">
        <div class="card-body">

          <h4 id="name2"></h4>
          <p><strong>Match Score:</strong> <span id="score2"></span>%</p>

          <h6 class="mt-3">Ingredients Required:</h6>
          <ul id="ing2"></ul>

          <h6 class="mt-3">Missing Ingredients:</h6>
          <ul id="miss2"></ul>

        </div>
      </div>
    </div>
  </div>

  <!-- Final Verdict -->
  <div class="card bg-dark border-secondary shadow-sm mt-4" id="verdictBox" style="display:none;">
    <div class="card-body">
      <h4 class="fw-bold">Final Verdict</h4>
      <p><strong>Better Match:</strong> <span id="better"></span></p>
      <p><strong>Score Difference:</strong> <span id="diff"></span>%</p>
    </div>
  </div>

</div>

<script>
  async function compare() {

    const id1 = document.getElementById("id1").value.trim();
    const id2 = document.getElementById("id2").value.trim();
    const ing = document.getElementById("userIng").value.trim();

    if (!id1 || !id2) {
      alert("Please enter both recipe IDs");
      return;
    }

    let formData = new FormData();
    formData.append("recipe_id1", id1);
    formData.append("recipe_id2", id2);
    formData.append("user_ingredients", ing);

    const response = await fetch("http://127.0.0.1:8000/compare", {
      method: "POST",
      body: formData
    });

    let data = await response.json();

    if (data.detail) {
      alert("Error: " + data.detail);
      return;
    }

    document.getElementById("compareBox").style.display = "flex";
    document.getElementById("verdictBox").style.display = "block";

    // Recipe 1
    document.getElementById("name1").textContent = data.recipe_1.recipe_name;
    document.getElementById("score1").textContent = data.recipe_1.match_score;

    document.getElementById("ing1").innerHTML = "";
    data.recipe_1.ingredients_required.forEach(i => {
      document.getElementById("ing1").innerHTML += `<li>${i}</li>`;
    });

    document.getElementById("miss1").innerHTML = "";
    data.recipe_1.missing_ingredients.forEach(i => {
      document.getElementById("miss1").innerHTML += `<li>${i}</li>`;
    });

    // Recipe 2
    document.getElementById("name2").textContent = data.recipe_2.recipe_name;
    document.getElementById("score2").textContent = data.recipe_2.match_score;

    document.getElementById("ing2").innerHTML = "";
    data.recipe_2.ingredients_required.forEach(i => {
      document.getElementById("ing2").innerHTML += `<li>${i}</li>`;
    });

    document.getElementById("miss2").innerHTML = "";
    data.recipe_2.missing_ingredients.forEach(i => {
      document.getElementById("miss2").innerHTML += `<li>${i}</li>`;
    });

    // Verdict
    document.getElementById("better").textContent = data.comparison_result.better_match;
    document.getElementById("diff").textContent = data.comparison_result.score_difference;
  }
</script>


{% endblock %}
